import 'dart:async'; import 'package:crafty_bay_ecommerce/api/category/category_list.dart';import 'package:crafty_bay_ecommerce/api/products/cart_list.dart';import 'package:crafty_bay_ecommerce/api/products/delete_cart_list.dart';import 'package:crafty_bay_ecommerce/api/products/list_porduct_slider.dart';import 'package:crafty_bay_ecommerce/api/products/list_product_by_brand.dart'; import 'package:crafty_bay_ecommerce/api/user/read_profile.dart';import 'package:crafty_bay_ecommerce/model/category%20list%20model/category_list_model.dart';import 'package:crafty_bay_ecommerce/model/products%20model/cart_list_model.dart';import 'package:crafty_bay_ecommerce/model/products%20model/list_product_by_brand_model.dart';import 'package:crafty_bay_ecommerce/model/products%20model/list_product_by_category_model.dart'; import 'package:crafty_bay_ecommerce/model/products%20model/list_product_slider_model.dart';import 'package:crafty_bay_ecommerce/model/user%20model/read_profile.dart'; import 'package:crafty_bay_ecommerce/utils/export.dart';import 'package:crafty_bay_ecommerce/utils/storage_key.dart';import 'package:crafty_bay_ecommerce/utils/store_data_value.dart';import '../../../../api/products/list_product_by_category.dart';import '../../../../utils/snackbar.dart';class HomeScreenController extends GetxController {  //List here  final List<ListProductSliderModel> _listProductSlider = [];  final List<ListProductByBrandModel> _listProductByBrand = [];  final  List<ReadProfileModel> _readProfile = [];  final List<CartListModel> _cartList = [];  //Get method  bool _isLoading = true;  bool get isLoading => _isLoading;  List<ListProductSliderModel>  get listProductSlider=>_listProductSlider;  List<ListProductByBrandModel>  get listProductByBrand=>_listProductByBrand;  List<ReadProfileModel>  get readProfile=>_readProfile;  List<CartListModel>  get cartList=>_cartList;  final TextEditingController searchController = TextEditingController();  // listProductSlider method  Future<void> fetchAndParseListProductSlider() async {    List<Map<String, dynamic>> response =    await fetchListProductSliderRequest();    _listProductSlider.clear();    _listProductSlider.addAll(        response.map((json) => ListProductSliderModel.fromJson(json)));  }  // List Product by brand method  Future<void> fetchAndParseListProductByBrand() async {    List<Map<String, dynamic>> response =        await fetchListProductByBrandRequest();    _listProductByBrand.clear();    _listProductByBrand.addAll(      response.map(        (json) => ListProductByBrandModel.fromJson(json),      ),    );  }//Cart List method  Future<void> fetchAndParseCartList() async {    List<Map<String, dynamic>> response = await fetchCartListRequest();    _cartList.clear();    _cartList.addAll(response.map((json) => CartListModel.fromJson(json)));  }//Read profile  Future<void> fetchAndParseReadProfile() async {    List<Map<String, dynamic>> response = await readProfileRequest();    _readProfile.clear();    _readProfile.addAll(      response.map(        (json) => ReadProfileModel.fromJson(json),      ),    );  }  // Initialize all data fetch method  Future<void> initializeMethod() async {    _isLoading = true;    update();    try {      await Future.wait([        fetchAndParseListProductSlider(),        fetchAndParseListProductByBrand(),      ]);    } catch (e) {      // Handle errors, e.g., show a snack-bar or an error message      throw Exception('Error fetching data :$e');    } finally {      fetchUserData();      _isLoading = false;      update();    }  }  int carouselCurrentIndex = 0;  void carouselSelectedIndex(index) {    carouselCurrentIndex = index;    update();  }  void fetchUserData() {    final tokenData = storageInstance.read(StorageKey.setTokenKey);    final emailData = storageInstance.read(StorageKey.setEmailKey);    if (tokenData != null && emailData != null) {      UserData.userToken = tokenData;      UserData.userEmail = emailData;      fetchAndParseCartList();      fetchAndParseReadProfile();    }  }  void isCheckLoggedIn() {    if (UserData.userToken.isEmpty) {      Get.toNamed(RouteName.emailVerifyScreen);    } else {      Get.defaultDialog(          title: 'Oh!',          content: const Text('Wait some times.Its a Technical problem'),          barrierDismissible: false,          onCancel: () {});    }  }  Future<void> deleteItems(id) async {    final response = await postDeleteCartList(id);    if (response['msg'] == 'success') {     await fetchAndParseCartList();      SnackToast.cartOperationSuccessful();    } else {      SnackToast.cartOperationFailed();    }  }  @override  void onInit() {    initializeMethod();    super.onInit();  }}